(function(e){var t={debug:!1,irisLoginAPI:"http://api.irislogin.it/",irisLogin:"http://irislogin.it/",images:{closeImage:"http://api.irislogin.it/public/img/btn-del-over-small.png",loaderBackImage:"http://api.irislogin.it/public/img/ajax-loader.gif"},scripts:{carouFredSel:"http://api.irislogin.it/public/js/jquery.carouFredSel.min.js",waitForImages:"http://api.irislogin.it/public/js/jquery.waitForImages.min.js"},galleries:[],websiteID:0,gallerySelected:0,startFrom:0,thumbs_visible:5,autoPlay:!1,wrapperID:!1,galleryID:"irislogin-gallery-",galleriesClass:"irislogin-galleries-wrapper",closeButtonID:!1,slideshowBackdropID:"slideshow-overall-backdrop",slideshowWrapperID:"slideshow-wrapper",slideshowCaruselID:"slideshow-carusel",slideshowThumbnailID:"slideshow-thumb"},n={position:{}},r=null,i=null,s=null,o={init:function(n){var r=t=e.extend(t,n);r.websiteID!=0?e.when(e.getScript(r.scripts.carouFredSel),e.getScript(r.scripts.waitForImages),e.Deferred(function(t){e(t.resolve)})).done(e.ajax({url:r.irisLoginAPI+"gallery/"+r.websiteID+"?callback=?",type:"GET",dataType:"jsonp",success:function(e,n,r){if(e.result)o.build(e.data.galleries);else{alert("Galleries not loaded. Check console for more informations.");if(t.debug){console.log("IrisLoginGallery: ERROR malformed data received!");console.log(e)}}},error:function(e,n,r){document.console.log("IrisLoginGallery: ERROR while getting data.");if(t.debug){console.log(e);console.log(r)}}})):document.console.log("IrisLoginGallery: ERROR No website ID given.")},build:function(n,r){setup=e.extend(t,r);if(!setup.wrapperID){alert("Wrong Setup. Check console for more informations.");console.log("Wrapper ID Not set.")}else for(var i=n.length-1;i>=0;i--){var s=n[i],u=setup.galleryID+s.gid;wrapper=e("<DIV/>").attr({id:u,"class":"well"}).css({width:"90%","min-width":"350px","max-width":"1200px",margin:"50px auto"});wrapper.append(e("<h2/>").text(s.name).css("text-align","center"));gall=e("<div/>").attr({"class":setup.galleriesClass,"data-gid":s.gid}).css({"text-align":"center",margin:"20px 0px 0px 10px"});for(var a=s.images.length-1;a>=0;a--){imageData=s.images[a];img=e("<img/>").attr({"class":"gallery-image",title:imageData.title,alt:imageData.descr,src:setup.irisLogin+imageData.thumb,"data-large":setup.irisLogin+imageData.full_size,"data-gid":s.gid,"data-imgID":imageData.id}).bind("click",function(e){o.prepare(this.getAttribute("data-imgid"),this.getAttribute("data-gid"))}).css({display:"inline-block",border:"1px solid #ccc",padding:"12px",margin:"0px 20px 20px 0px"});gall.prepend(img)}wrapper.append(gall);wrapper.prependTo("#"+setup.wrapperID)}},prepare:function(u,a,f){setup=e.extend(t,f);var l=setup.galleryID+a,c=e("<div/>").attr({id:setup.slideshowBackdropID}).css({position:"fixed",top:0,left:0,width:"100%",height:"100%","min-height":e(window).height,"background-image":"url("+setup.images.loaderBackImage+")","background-repeat":"no-repeat","background-position":"center","background-color":"#FAFAFA","z-index":5e3,opacity:0}),h=e(window).width(),p=e(window).height();n.width=h*.8;n.height=p*.75;n.position.top=p/2-n.height/2;n.position.left=h/2-n.width/2;s=e("<div/>").attr({id:setup.slideshowWrapperID}).css({position:"fixed",width:n.width,height:n.height,top:n.position.top,left:n.position.left,"background-color":"#000","box-shadow":"0 20px 50px #333","z-index":5500,overflow:"hidden",opacity:0});i=e("#"+l+" ."+setup.galleriesClass).clone().removeClass(setup.galleriesClass);i.attr({id:setup.slideshowThumbnailID,style:!1}).css({height:"120px",overflow:"hidden",position:"relative",bottom:"50px","min-width":"250px","z-index":6500}).find("img").each(function(){this.removeAttribute("data-large");this.removeAttribute("style");e(this).css({display:"block","float":"left",margin:"10px",width:"100px",height:"100px","box-shadow":"0 0 10px #000"})});r=e("#"+l+" ."+setup.galleriesClass).clone().removeClass(setup.galleriesClass);r.attr({id:setup.slideshowCaruselID,style:!1}).css({overflow:"hidden","z-index":6e3}).find("img").each(function(e){if(this.src){this.onload=function(){var e=s.height()/this.height,t=this.width*e;this.setAttribute("width",t);this.setAttribute("height",s.height());this.removeAttribute("style");this.style.display="block";this.style.float="left"};this.src=this.getAttribute("data-large");this.removeAttribute("data-large")}});s.append(r);s.append(i);i.children("img").click(function(){u=this.getAttribute("data-imgid");selector="#"+setup.slideshowCaruselID+" img[data-imgid="+u+"]";r.trigger("slideTo",[e(selector)])}).css("cursor","pointer");s.hover(function(){r.trigger("pause");i.parent().animate({bottom:"120"})},function(){r.trigger("play");i.parent().animate({bottom:"30"})});c.click(function(){o.destroy()});var d=e("<img/>").attr({src:setup.images.closeImage}).css({position:"fixed",top:n.position.top-15,left:n.position.left-15,"z-index":9e3}).bind("click",o.destroy).appendTo(s);setup.closeButtonID!=0&&e(setup.closeButtonID).bind("click",function(t){t.preventDefault();e(this).unbind("click");o.destroy()});e("body").append(c);e("body").append(s);c.animate({opacity:1},"fast");r.waitForImages({finished:function(){setTimeout(function(){o.start(u,a,f)},50)}})},start:function(s,o,u){setup=e.extend(t,u);var a=setup.galleryID+o;r=e("#"+setup.slideshowCaruselID);i=e("#"+setup.slideshowThumbnailID);r.carouFredSel({width:"100%",height:"100%",items:{start:e("#"+setup.slideshowCaruselID+" img[data-imgid="+s+"]"),visible:1,height:n.height},scroll:{fx:"crossfade",onBefore:function(t){s=t.items.visible.data("imgid");pos=Math.floor(setup.thumbs_visible/2)-1;i.trigger("slideTo",[e("#"+setup.slideshowThumbnailID+" img[data-imgid="+s+"]"),-pos])}},prev:{key:"left"},next:{key:"right"},onCreate:function(t){e("#"+setup.slideshowWrapperID).animate({opacity:1})}},{debug:!0});i.carouFredSel({auto:!1,width:"100%"});setup.thumbs_visible=i.children("img").size();r.trigger("play",[0,!0])},stop:function(){e("#"+setup.slideshowCaruselID).trigger("stop");e("#"+setup.slideshowThumbnailID).trigger("stop")},update:function(t){e("#"+setup.slideshowCaruselID).trigger("updateSizes");e("#"+setup.slideshowThumbnailID).trigger("updateSizes")},destroy:function(n){setup=e.extend(t,n);var r=document.getElementById(setup.slideshowWrapperID),i=document.getElementById(setup.slideshowBackdropID);o.stop();e(r).animate({opacity:0},200,function(){r.parentNode.removeChild(r)});e(i).animate({opacity:0},200,function(){e("#"+setup.slideshowCaruselID).trigger("destroy");e("#"+setup.slideshowThumbnailID).trigger("destroy");i.parentNode.removeChild(i)})}};e.fn.irisLoginGallery=function(t){if(o[t])return o[t].apply(this,Array.prototype.slice.call(arguments,1));if(typeof t=="object"||!t)return o.init.apply(this,arguments);e.error("Method "+method+" does not exist on jQuery.irisLoginGallery")}})(jQuery);